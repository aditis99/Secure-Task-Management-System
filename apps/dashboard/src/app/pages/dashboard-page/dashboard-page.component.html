<div class="mx-auto max-w-6xl px-4 py-8">
  <section class="rounded-2xl bg-gradient-to-br from-brand to-indigo-600 px-8 py-10 text-white shadow-lg">
    <h1 class="text-3xl font-semibold">Task Operations Center</h1>
    <p class="mt-2 text-slate-100">
      Track secure tasks across organizations, approve workload changes, and monitor activity at a glance.
    </p>
    <div class="mt-6 flex items-center gap-4">
      <a routerLink="/login" class="hidden text-white/80 underline decoration-white/50 hover:text-white md:inline">
        Switch account
      </a>
    </div>
  </section>

  <section class="mt-8 grid gap-4 sm:grid-cols-3">
    <article
      *ngFor="let card of summaryCards()"
      class="rounded-2xl border border-slate-200 bg-white p-6 shadow-sm transition hover:-translate-y-0.5 hover:shadow-md"
    >
      <p class="text-sm font-medium text-slate-500">{{ card.label }}</p>
      <p class="mt-2 text-3xl font-semibold text-slate-900">{{ card.value }}</p>
      <p class="text-xs text-emerald-500" *ngIf="card.trend">{{ card.trend }}</p>
    </article>
  </section>

  <section class="mt-10 grid gap-6 lg:grid-cols-3">
    <div class="lg:col-span-2 space-y-4 rounded-2xl border border-slate-200 bg-white p-6 shadow-sm">
      <div class="flex items-center justify-between">
        <h2 class="text-lg font-semibold text-slate-900">Active tasks</h2>
        <button class="text-sm text-brand" (click)="loadTasks()">
          Refresh
        </button>
      </div>

      <p *ngIf="isLoading()" class="rounded-lg bg-slate-100 px-4 py-2 text-sm text-slate-600">
        Loading tasks&hellip;
      </p>

      <p *ngIf="loadError()" class="rounded-lg bg-red-50 px-4 py-2 text-sm text-red-600">
        {{ loadError() }}
      </p>

      <ng-container *ngIf="!isLoading() && !loadError()">
        <div *ngIf="tasks().length; else emptyState" class="overflow-x-auto">
          <table class="min-w-full divide-y divide-slate-200 text-sm">
            <thead class="bg-slate-50 text-left text-xs font-semibold uppercase tracking-wide text-slate-500">
              <tr>
                <th class="px-4 py-3">Title</th>
                <th class="px-4 py-3">Category</th>
                <th class="px-4 py-3">Status</th>
                <th class="px-4 py-3">Due</th>
                <th class="px-4 py-3">Organization</th>
                <th class="px-4 py-3">Owner</th>
                <th class="px-4 py-3 text-right" *ngIf="canManageTasks()">Actions</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-slate-100">
              <tr *ngFor="let task of tasks(); trackBy: trackByTaskId" class="hover:bg-slate-50">
                <td class="px-4 py-3">
                  <p class="font-medium text-slate-900">{{ task.title }}</p>
                  <p class="text-xs text-slate-500" *ngIf="task.description">{{ task.description }}</p>
                </td>
                <td class="px-4 py-3 text-slate-600">{{ task.category }}</td>
                <td class="px-4 py-3">
                  <span class="rounded-full px-3 py-1 text-xs font-semibold" [ngClass]="badgeClass(task.status)">
                    {{ task.status.replace('_', ' ') }}
                  </span>
                </td>
                <td class="px-4 py-3 text-slate-600">
                  {{ task.dueDate ? (task.dueDate | date: 'mediumDate') : '—' }}
                </td>
                <td class="px-4 py-3 text-slate-600">
                  {{ task.organization?.name || '—' }}
                </td>
                <td class="px-4 py-3 text-slate-600">
                  {{ task.createdBy?.firstName || '' }} {{ task.createdBy?.lastName || '' }}
                  <div class="text-xs text-slate-400">{{ task.createdBy?.email }}</div>
                </td>
                <td class="px-4 py-3 text-right" *ngIf="canManageTasks()">
                  <div class="flex items-center justify-end gap-2">
                    <!-- Edit functionality temporarily disabled for system stability -->
                    <!--
                    <button
                      class="text-xs font-semibold text-brand hover:underline"
                    >
                      Edit
                    </button>
                    -->
                    <button
                      type="button"
                      class="text-xs font-semibold text-red-500 hover:text-red-600"
                      [disabled]="deletingTaskId() === task.id"
                      (click)="deleteTask(task.id)"
                    >
                      {{ deletingTaskId() === task.id ? 'Deleting…' : 'Delete' }}
                    </button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <ng-template #emptyState>
          <div class="rounded-lg border border-dashed border-slate-300 px-6 py-10 text-center text-slate-500">
            No tasks yet. Create one to get started.
          </div>
        </ng-template>
      </ng-container>
    </div>

    <div class="rounded-2xl border border-dashed border-slate-300 bg-white/60 p-6">
      <h3 class="text-base font-semibold text-slate-900">Task composer</h3>
      <p class="mt-1 text-sm text-slate-500">Use the form to capture new tasks or update existing ones.</p>
      <router-outlet #taskCreator="outlet"></router-outlet>
      <p class="mt-6 text-sm text-slate-500" *ngIf="!taskCreator.isActivated">
        Choose <span class="font-medium text-slate-800">New Task</span> in the navigation to create a task.
      </p>
    </div>
  </section>
</div>
